# ุชุญููู ุงูุนูุงูุงุช ุจูู Product, Unit, ู ProductUnit

## ๐ ุงูุจููุฉ ุงูุญุงููุฉ

### 1. ุงูุฌุฏุงูู ูุงูุนูุงูุงุช

```
Product (1) โโโโโโ< (Many) ProductUnit (Many) >โโโโโโ (1) Unit
```

**ุงูุนูุงูุฉ:** Many-to-Many ุนุจุฑ ุฌุฏูู ูุณูุท (ProductUnit)

### 2. ุชูุงุตูู ุงูุฌุฏุงูู

#### ุฌุฏูู Product
- `id` (PK)
- `product_name`
- `selling_price` (ุณุนุฑ ุงูุชุฑุงุถู)
- `category_id`
- ... (ุญููู ุฃุฎุฑู)

#### ุฌุฏูู Unit
- `id` (PK)
- `unit_name` (ูุซู: ููููุ ูุทุนุฉุ ูุชุฑ)
- `is_active`

#### ุฌุฏูู ProductUnit (Junction Table)
- `id` (PK)
- `product_id` (FK โ Product)
- `unit_id` (FK โ Unit)
- `sale_price` (ุณุนุฑ ุงูุจูุน ููุฐุง ุงูููุชุฌ ุจูุฐู ุงููุญุฏุฉ) โญ
- `conversion_factor` (ูุนุงูู ุงูุชุญููู ุจูู ุงููุญุฏุงุช) โญ
- `is_default` (ุงููุญุฏุฉ ุงูุงูุชุฑุงุถูุฉ ููุฐุง ุงูููุชุฌ) โญ

**Unique Constraint:** (product_id, unit_id) - ูุง ูููู ุชูุฑุงุฑ ููุณ ุงูููุชุฌ ุจููุณ ุงููุญุฏุฉ

---

## ๐ ุชุญููู ุงูุงุณุชุฎุฏุงู

### ุงุณุชุฎุฏุงู ProductUnit:
1. **ุชุฎุฒูู ุฃุณุนุงุฑ ูุฎุชููุฉ ูููุณ ุงูููุชุฌ ุจูู ูุญุฏุฉ**
   - ูุซุงู: ููุชุฌ "ุฃุฑุฒ" ูุฏ ูููู:
     - ุจุงููููู: 5000 ุฑูุงู
     - ุจุงูุทู: 4,500,000 ุฑูุงู
     - ุจุงูููุณ (50 ูููู): 200,000 ุฑูุงู

2. **ูุนุงููุงุช ุงูุชุญููู ุจูู ุงููุญุฏุงุช**
   - ูุซุงู: 1 ุทู = 1000 ูููู
   - ูุณุงุนุฏ ูู ุงูุชุญููู ุงูุชููุงุฆู ุจูู ุงููุญุฏุงุช

3. **ุชุญุฏูุฏ ุงููุญุฏุฉ ุงูุงูุชุฑุงุถูุฉ**
   - ูู ููุชุฌ ูู ูุญุฏุฉ ุงูุชุฑุงุถูุฉ ููุจูุน

### ุงุณุชุฎุฏุงู InvoiceProduct:
- ูุณุชุฎุฏู `product_id` ู `unit_id` **ูุจุงุดุฑุฉ**
- **ูุง ูุณุชุฎุฏู** `product_unit_id`
- ูุนูู: ุงููุงุชูุฑุฉ ุชุญุฏุฏ ุงูููุชุฌ ูุงููุญุฏุฉ ูุจุงุดุฑุฉุ ุซู ูููู ุงูุจุญุซ ุนู ุงูุณุนุฑ ูู ProductUnit

---

## โ ูู ูููู ุงูุงุณุชุบูุงุก ุนู ProductUnitุ

### โ **ุงูุฅุฌุงุจุฉ: ูุงุ ูุง ูููุตุญ ุจุงูุงุณุชุบูุงุก ุนูู**

### ุงูุฃุณุจุงุจ:

#### 1. **ุงูุจูุงูุงุช ุงููููุฉ ูู ProductUnit:**
   - `sale_price`: ุณุนุฑ ูุฎุชูู ููู ููุชุฌ+ูุญุฏุฉ
   - `conversion_factor`: ูุนุงูู ุชุญููู ุฎุงุต ุจูู ููุชุฌ+ูุญุฏุฉ
   - `is_default`: ุงููุญุฏุฉ ุงูุงูุชุฑุงุถูุฉ ููู ููุชุฌ

#### 2. **ุงููุดุงูู ุนูุฏ ุงูุงุณุชุบูุงุก:**

   **ุงูุฎูุงุฑ 1: ููู ุงูุจูุงูุงุช ุฅูู Product**
   ```
   โ ูุดููุฉ: ุงูููุชุฌ ุงููุงุญุฏ ูุฏ ูููู ูู ุนุฏุฉ ูุญุฏุงุช ุจุฃุณุนุงุฑ ูุฎุชููุฉ
   โ ูุซุงู: ููุชุฌ "ุฃุฑุฒ" ูู 3 ูุญุฏุงุช (ููููุ ุทูุ ููุณ) ุจุฃุณุนุงุฑ ูุฎุชููุฉ
   โ ูุง ูููู ุชุฎุฒูู 3 ุฃุณุนุงุฑ ูู ููุณ ุงูุณุฌู
   ```

   **ุงูุฎูุงุฑ 2: ููู ุงูุจูุงูุงุช ุฅูู Unit**
   ```
   โ ูุดููุฉ: ููุณ ุงููุญุฏุฉ (ูุซู "ูููู") ูุฏ ูููู ููุง ุฃุณุนุงุฑ ูุฎุชููุฉ ูููุชุฌุงุช ูุฎุชููุฉ
   โ ูุซุงู: ูููู ุฃุฑุฒ = 5000ุ ูููู ุณูุฑ = 3000
   โ ูุง ูููู ุชุฎุฒูู ุฃุณุนุงุฑ ูุฎุชููุฉ ูููุณ ุงููุญุฏุฉ
   ```

   **ุงูุฎูุงุฑ 3: ููู ุงูุจูุงูุงุช ุฅูู InvoiceProduct**
   ```
   โ ูุดููุฉ: ุงูุณุนุฑ ูุฌุจ ุฃู ูููู ูุชุงุญ ูุจู ุฅูุดุงุก ุงููุงุชูุฑุฉ
   โ ูุดููุฉ: ููุณ ุงูุณุนุฑ ุณูููุฑุฑ ูู ูู ูุงุชูุฑุฉ (ุฅูุฏุงุฑ ูุณุงุญุฉ)
   โ ูุดููุฉ: ุชุบููุฑ ุงูุณุนุฑ ุณูุชุทูุจ ุชุญุฏูุซ ุฌููุน ุงูููุงุชูุฑ ุงููุฏููุฉ
   ```

---

## ๐ก ุงูุญููู ุงูุจุฏููุฉ (ุฅุฐุง ุฃุฑุฏุช ุงูุงุณุชุบูุงุก)

### ุงูุญู 1: Many-to-Many ูุจุงุดุฑ ุจุฏูู ุจูุงูุงุช ุฅุถุงููุฉ
```
Product (Many) โโโโโโ< InvoiceProduct >โโโโโโ (Many) Unit
```

**ุงููุดุงูู:**
- โ ููุฏุงู `sale_price` ููู ููุชุฌ+ูุญุฏุฉ
- โ ููุฏุงู `conversion_factor`
- โ ููุฏุงู `is_default`
- โ ูุฌุจ ุชุฎุฒูู ุงูุณุนุฑ ูู ูู ูุงุชูุฑุฉ (ุฅูุฏุงุฑ ูุณุงุญุฉ)

**ุงูุญู:**
- ููู `sale_price` ุฅูู `InvoiceProduct` (ููู ูุฐุง ุณูุถุงุนู ุงูุจูุงูุงุช)
- ุงุณุชุฎุฏุงู `Product.selling_price` ูุณุนุฑ ุงูุชุฑุงุถู (ููู ูู ูุนูู ูุน ูุญุฏุงุช ูุชุนุฏุฏุฉ)

### ุงูุญู 2: Many-to-Many ูุน ุจูุงูุงุช ูู ุฌุฏูู ูุณูุท ูุฎุชูู
```
Product (1) โโโโโโ< ProductUnitPricing (Many) >โโโโโโ (1) Unit
```

**ูุฐุง ููุณ ProductUnit!** ููุท ุชุบููุฑ ุงูุงุณู.

---

## ๐ฏ ุงูุชูุตูุฉ ุงูููุงุฆูุฉ

### โ **ุงูุงุญุชูุงุธ ุจุฌุฏูู ProductUnit**

#### ุงููููุฒุงุช:
1. โ **ูุฑููุฉ ูู ุงูุฃุณุนุงุฑ**: ูู ููุชุฌ+ูุญุฏุฉ ูู ุณุนุฑ ุฎุงุต
2. โ **ูุนุงููุงุช ุงูุชุญููู**: ุณูููุฉ ุงูุชุญููู ุจูู ุงููุญุฏุงุช
3. โ **ุงููุญุฏุฉ ุงูุงูุชุฑุงุถูุฉ**: ุชุญุฏูุฏ ุงููุญุฏุฉ ุงูุงูุชุฑุงุถูุฉ ููู ููุชุฌ
4. โ **ุฃุฏุงุก ุฌูุฏ**: Unique Index ุนูู (product_id, unit_id) ูุถูู ุณุฑุนุฉ ุงูุจุญุซ
5. โ **ุชุทุจูุน ูุงุนุฏุฉ ุงูุจูุงูุงุช**: ูุชุจุน ูุจุงุฏุฆ Normalization ุงูุตุญูุญุฉ

#### ุงูุฃุฏุงุก:
- โ **Index ุนูู (product_id, unit_id)**: ุงูุจุญุซ ุณุฑูุน ุฌุฏุงู
- โ **Foreign Keys**: ุถูุงู ุชูุงูู ุงูุจูุงูุงุช
- โ **ูุง ููุฌุฏ ูุดุงูู ุฃุฏุงุก**: ุงูุฌุฏูู ุตุบูุฑ ูุณุจูุงู

---

## ๐ง ุชุญุณููุงุช ููุชุฑุญุฉ (ุจุฏูู ุงูุงุณุชุบูุงุก ุนู ProductUnit)

### 1. ุฅุถุงูุฉ Index ุฅุถุงูู:
```csharp
// ูู AppDbContext
modelBuilder.Entity<ProductUnit>()
    .HasIndex(pu => pu.ProductId)
    .HasDatabaseName("idx_product_unit_product");

modelBuilder.Entity<ProductUnit>()
    .HasIndex(pu => pu.UnitId)
    .HasDatabaseName("idx_product_unit_unit");
```

### 2. ุฅุถุงูุฉ Index ุนูู is_default:
```csharp
modelBuilder.Entity<ProductUnit>()
    .HasIndex(pu => new { pu.ProductId, pu.IsDefault })
    .HasDatabaseName("idx_product_unit_default")
    .HasFilter("\"is_default\" = true");
```

### 3. ุชุญุณูู ุงูุงุณุชุนูุงูุงุช:
```csharp
// ุจุฏูุงู ูู:
var productUnits = await _context.ProductUnits
    .Include(pu => pu.Product)
    .Include(pu => pu.Unit)
    .ToListAsync();

// ุงุณุชุฎุฏู:
var productUnits = await _context.ProductUnits
    .Where(pu => pu.ProductId == productId)
    .Select(pu => new {
        pu.Id,
        pu.SalePrice,
        pu.Unit.UnitName
    })
    .ToListAsync();
```

---

## ๐ ุงูุฎูุงุตุฉ

| ุงูุณุคุงู | ุงูุฅุฌุงุจุฉ |
|--------|---------|
| ูู ูููู ุงูุงุณุชุบูุงุก ุนู ProductUnitุ | โ ูุงุ ูุง ูููุตุญ |
| ููุงุฐุงุ | ูุญุชูู ุนูู ุจูุงูุงุช ูููุฉ (sale_price, conversion_factor, is_default) |
| ูู ูุคุซุฑ ุนูู ุงูุฃุฏุงุกุ | โ ูุงุ ุงูุฃุฏุงุก ุฌูุฏ ูุน Indexes |
| ูุง ุงูุชูุตูุฉุ | โ **ุงูุงุญุชูุงุธ ุจุฌุฏูู ProductUnit** |

---

## ๐ ุฅุฐุง ุฃุฑุฏุช ุชุทุจูู ุงูุชุญุณููุงุช

ูููููู ูุณุงุนุฏุชู ูู:
1. ุฅุถุงูุฉ Indexes ุฅุถุงููุฉ ูุชุญุณูู ุงูุฃุฏุงุก
2. ุชุญุณูู ุงูุงุณุชุนูุงูุงุช ูู Controllers
3. ุฅุถุงูุฉ Validation ููุชุฃูุฏ ูู ูุฌูุฏ ูุญุฏุฉ ุงูุชุฑุงุถูุฉ ูุงุญุฏุฉ ููู ููุชุฌ

